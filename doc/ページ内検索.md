# ページ内検索

## 構造

区分番号一覧におけるHTMLの構造は以下の通り

```
<body>
  <div id='all'>
    <div id='breadcrumb'>
      <div id='menu'></div>
      <script type='text/javascript' src='../../menu.js'></script>
    </div>
    <div id='content'>
      <h1 class='title'>令和06年医科診療報酬点数表 区分番号一覧</h1>
      <p style='...'><a href='...'>旧</a> <a href='A000.html'>新</a> <a href='...'>比較</a> Ａ０００ 初診料</p>
      ...
    </div>
  </div>
```

# 変更の方針

「div id='breadcrumb'」内にページ内検索用のテキストボックスを追加する。
ここのHTMLテキストはJavaScriptにより動的に生成されるので、
テキストボックスも同様に動的に生成することになる。
「div id='breadcrumb'」を持つページはすべてページ内検索ができる。

変更するファイルは以下のふたつとなる。
* all.css
* menu.js

# 参考としたページ

## ページ内検索

[リアルタイムにページ内検索をしてハイライト表示する](https://mo2nabe.com/js-search-in-page/)

## クリアボタン付きテキストボックス

[How do I put a clear button inside my HTML text input box like the iPhone does?](https://stackoverflow.com/questions/2803532/how-do-i-put-a-clear-button-inside-my-html-text-input-box-like-the-iphone-does)

テキストボックスの右端に
丸付きの「x」ボタンを配置し、
これをクリックするとテキストボックスを
クリアする。

## ハイライトされない不具合(2025-12-12)

### 検索文字列

"-" (半角ハイフン)

### 表示

４つのハイフンが全くハイライトされない。

```
－ － －－ Ａ００３ 削除
```

### ソース

```
<p style='margin-left:5.5em;text-indent:-5.5em'>－ － －－ Ａ００３ 削除</p>
```

rawSearchWord=-
searchWord=[-ー]
contentRegexp=/(?<=>[^<>]*)([-ー－])/gi
rawRegexp=/[-ー－]/gi

## 原因
段落のinnerHTMLを置換しているが、innerHTMLには
タグがないのでcontentRegexpにマッチしない。

## 対策
段落のouterHTMLを置換するようにした。